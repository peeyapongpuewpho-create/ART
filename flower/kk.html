<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>พลุหัวใจผสมดอกไม้</title>
<style>
  body, html {
    margin:0; padding:0; overflow:hidden; background:#000;
  }
  canvas {
    display: block;
  }
</style>
</head>
<body>

<canvas id="canvas"></canvas>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// อนุภาค (particle) ที่จะใช้ทั้งพลุและระเบิดหัวใจ/ดอกไม้
class Particle {
  constructor(x, y, vx, vy, size, color, shape, life) {
    this.x = x;
    this.y = y;
    this.vx = vx; // ความเร็วแกน x
    this.vy = vy; // ความเร็วแกน y
    this.size = size;
    this.color = color;
    this.shape = shape; // "heart" หรือ "flower"
    this.life = life; // อายุของอนุภาค
    this.opacity = 1;
    this.rotation = Math.random() * Math.PI * 2; // มุมหมุนเริ่มต้น
    this.rotationSpeed = (Math.random() - 0.5) * 0.1; // ความเร็วหมุน
  }
  
  update() {
    this.x += this.vx;
    this.y += this.vy;
    this.vy += 0.02; // แรงโน้มถ่วงเบา ๆ
    this.life--;
    this.opacity = this.life / 100;
    this.rotation += this.rotationSpeed;
  }
  
  drawHeart() {
    ctx.save();
    ctx.translate(this.x, this.y);
    ctx.rotate(this.rotation);
    ctx.beginPath();
    const size = this.size;
    ctx.moveTo(0, 0);
    ctx.bezierCurveTo(-size/2, -size/2, -size, size/3, 0, size);
    ctx.bezierCurveTo(size, size/3, size/2, -size/2, 0, 0);
    ctx.fillStyle = `rgba(${this.color}, ${this.opacity})`;
    ctx.fill();
    ctx.restore();
  }
  
  drawFlower() {
    ctx.save();
    ctx.translate(this.x, this.y);
    ctx.rotate(this.rotation);
    const size = this.size;
    ctx.fillStyle = `rgba(${this.color}, ${this.opacity})`;
    for(let i=0; i<5; i++){
      ctx.beginPath();
      ctx.ellipse(
        Math.cos((i*2*Math.PI)/5)*size/2,
        Math.sin((i*2*Math.PI)/5)*size/2,
        size/3, size/1.5, 0, 0, 2*Math.PI
      );
      ctx.fill();
    }
    // กลางดอก
    ctx.beginPath();
    ctx.arc(0, 0, size/3, 0, 2*Math.PI);
    ctx.fill();
    ctx.restore();
  }
  
  draw() {
    if(this.shape === "heart") this.drawHeart();
    else this.drawFlower();
  }
}

class Firework {
  constructor() {
    this.x = Math.random() * canvas.width;
    this.y = canvas.height + 10;
    this.vy = -(4 + Math.random() * 3); // ความเร็วพุ่งขึ้น
    this.exploded = false;
    this.particles = [];
  }
  
  update() {
    if(!this.exploded){
      this.y += this.vy;
      this.vy += 0.05; // แรงโน้มถ่วง (ชะลอ)
      if(this.vy >= 0){ // ถึงจุดสูงสุดระเบิด
        this.exploded = true;
        this.createParticles();
      }
    } else {
      this.particles.forEach((p, i) => {
        p.update();
        if(p.life <= 0){
          this.particles.splice(i,1);
        }
      });
    }
  }
  
  createParticles() {
    const colors = [
      "255, 100, 150", // ชมพู
      "255, 180, 100", // ส้ม
      "200, 255, 150", // เขียวอ่อน
      "255, 255, 150", // เหลืองอ่อน
      "180, 150, 255"  // ม่วงอ่อน
    ];
    const shapeTypes = ["heart", "flower"];
    
    for(let i=0; i<30; i++){
      const angle = (Math.PI*2/30)*i;
      const speed = Math.random()*3 + 1.5;
      const vx = Math.cos(angle)*speed;
      const vy = Math.sin(angle)*speed;
      const size = 8 + Math.random()*6;
      const color = colors[Math.floor(Math.random()*colors.length)];
      const shape = shapeTypes[Math.floor(Math.random()*shapeTypes.length)];
      const life = 100 + Math.floor(Math.random()*50);
      this.particles.push(new Particle(this.x, this.y, vx, vy, size, color, shape, life));
    }
  }
  
  draw() {
    if(!this.exploded){
      // วาดพลุก่อนระเบิด เป็นจุดชมพูเล็ก ๆ
      ctx.beginPath();
      ctx.arc(this.x, this.y, 4, 0, 2*Math.PI);
      ctx.fillStyle = "pink";
      ctx.fill();
    } else {
      this.particles.forEach(p => p.draw());
    }
  }
}

const fireworks = [];

function loop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  
  // สร้างพลุใหม่ถ้าน้อยกว่า 5 ดอก
  if(fireworks.length < 5 && Math.random() < 0.05){
    fireworks.push(new Firework());
  }
  
  fireworks.forEach((f,i) => {
    f.update();
    f.draw();
    // ลบพลุถ้าจบแล้ว
    if(f.exploded && f.particles.length === 0){
      fireworks.splice(i,1);
    }
  });
  
  requestAnimationFrame(loop);
}

loop();

window.addEventListener("resize", () => {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
});
</script>

</body>
</html>
